# Parent function: tpa:telepot/next_node (teleport_state == 3)

# Binary Teleports
execute store result score #x tpa.variables run data get entity @s Pos[0]
execute store result score #x_dist tpa.variables run data get storage tpa:tpa temp.teleport.Pos[0]
scoreboard players operation #x_dist tpa.variables -= #x tpa.variables
execute store result score #z tpa.variables run data get entity @s Pos[2]
execute store result score #z_dist tpa.variables run data get storage tpa:tpa temp.teleport.Pos[2]
scoreboard players operation #z_dist tpa.variables -= #z tpa.variables

# 16,777,216 = 2^24
# Stops here because 8 block is even shorter than a chunk's length, we use anchor teleport for the last step, same for Z and negatives
execute if score #x_dist tpa.variables matches 8.. at @s run function tpa:teleport/binary/approach/positive_x
execute if score #x_dist tpa.variables matches ..-8 at @s run function tpa:teleport/binary/approach/negative_x
execute if score #z_dist tpa.variables matches 8.. at @s run function tpa:teleport/binary/approach/positive_z
execute if score #z_dist tpa.variables matches ..-8 at @s run function tpa:teleport/binary/approach/negative_z

# Calc dists
scoreboard players set #dist tpa.variables 0
execute if score #x_dist tpa.variables matches 1.. run scoreboard players operation #dist tpa.variables += #x_dist tpa.variables
execute if score #x_dist tpa.variables matches ..0 run scoreboard players operation #dist tpa.variables -= #x_dist tpa.variables
execute if score #z_dist tpa.variables matches 1.. run scoreboard players operation #dist tpa.variables += #z_dist tpa.variables
execute if score #z_dist tpa.variables matches ..0 run scoreboard players operation #dist tpa.variables -= #z_dist tpa.variables

execute if score #debug_mode tpa.config matches 1 run tellraw @a ["[§bTPA§r] §6 Debug§r: Binary Teleport approached once: ", {"score":{"objective":"tpa.variables","name":"#x_dist"}, "color": "green"}, "+", {"score":{"objective":"tpa.variables","name":"#z_dist"}, "color": "green"}, "/",{"score":{"objective":"tpa.variables","name":"#original_distance"}}]
scoreboard players operation #current tpa.variables = #dist tpa.variables
scoreboard players operation #total tpa.variables = #original_distance tpa.variables
function tpa:teleport/progress_bar/main
function tpa:load_lang
title @s actionbar [{"storage": "tpa:tpa", "nbt": "loaded_lang.teleport_binary_actionbar"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[0]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[1]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[2]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[3]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[4]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[5]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[6]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[7]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[8]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[9]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[10]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[11]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[12]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[13]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[14]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[15]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[16]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[17]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[18]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[19]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[20]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[21]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[22]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[23]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[24]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[25]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[26]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[27]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[28]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[29]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[30]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[31]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[32]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[33]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[34]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[35]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[36]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[37]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[38]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[39]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[40]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[41]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[42]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[43]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[44]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[45]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[46]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[47]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[48]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[49]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[50]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[51]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[52]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[53]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[54]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[55]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[56]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[57]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[58]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[59]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[60]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[61]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[62]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[63]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[64]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[65]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[66]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[67]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[68]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[69]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[70]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[71]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[72]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[73]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[74]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[75]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[76]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[77]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[78]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[79]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[80]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[81]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[82]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[83]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[84]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[85]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[86]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[87]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[88]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[89]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[90]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[91]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[92]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[93]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[94]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[95]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[96]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[97]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[98]"}, {"storage": "tpa:tpa", "nbt": "temp.progress_bar[99]"}, "§r  (", {"score": {"name": "#percentage", "objective": "tpa.variables"}},"%)"]

execute if entity @e[sort=nearest, limit=1, tag=tpa.teleport_destin_anchor] run scoreboard players set #teleport_state tpa.variables 2